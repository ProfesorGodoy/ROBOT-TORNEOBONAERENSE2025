#include <SoftwareSerial.h>
#include <Servo.h>

// CONEXIONES PARA EL BLUETOOTH
int bluetoothTx = 2;
int bluetoothRx = 3;
SoftwareSerial bluetooth(bluetoothTx, bluetoothRx);

// PINES PARA LOS MOTORES
int Motor1A = 5;
int Motor1B = 6;
int Motor2A = 9;
int Motor2B = 10;

// FLAGS PARA EVITAR COMANDOS REPETIDOS
int flag1 = -1; // Movimiento adelante/atrás
int flag2 = -1; // Giro

void setup() {
  // CONFIGURACIÓN BLUETOOTH
  bluetooth.begin(115200);
  bluetooth.print("$$$");
  delay(100);
  bluetooth.println("U,9600,N");
  bluetooth.begin(9600);

  // CONFIGURAR PINES COMO SALIDA
  pinMode(Motor1A, OUTPUT);
  pinMode(Motor1B, OUTPUT);
  pinMode(Motor2A, OUTPUT);
  pinMode(Motor2B, OUTPUT);

  // APAGAR MOTORES INICIALMENTE
  detenerMotores();
}

void loop() {
  if (bluetooth.available()) {
    char toSend = (char)bluetooth.read();

    switch (toSend) {
      case 'S': // STOP
        flag1 = 0;
        flag2 = 0;
        detenerMotores();
        break;

      case 'F': case 'G': case 'I': // ADELANTE
        if (flag1 != 1) {
          flag1 = 1;
          moverAdelante();
        }
        break;

      case 'B': case 'H': case 'J': // REVERSA
        if (flag1 != 2) {
          flag1 = 2;
          moverAtras();
        }
        break;
    }

    if (toSend == 'L' || toSend == 'G' || toSend == 'H') { // IZQUIERDA
      if (flag2 != 1) {
        flag2 = 1;
        girarIzquierda();
      }
    } else if (toSend == 'R' || toSend == 'I' || toSend == 'J') { // DERECHA
      if (flag2 != 2) {
        flag2 = 2;
        girarDerecha();
      }
    } else { // NEUTRALIZAR GIRO
      if (flag2 != 3) {
        flag2 = 3;
        detenerGiro();
      }
    }
  }
}

// --- FUNCIONES DE MOVIMIENTO ---

void detenerMotores() {
  digitalWrite(Motor1A, LOW);
  digitalWrite(Motor1B, LOW);
  digitalWrite(Motor2A, LOW);
  digitalWrite(Motor2B, LOW);
}

void moverAdelante() {
  digitalWrite(Motor1A, HIGH);
  digitalWrite(Motor1B, LOW);
  digitalWrite(Motor2A, HIGH);
  digitalWrite(Motor2B, LOW);
}

void moverAtras() {
  digitalWrite(Motor1A, LOW);
  digitalWrite(Motor1B, HIGH);
  digitalWrite(Motor2A, LOW);
  digitalWrite(Motor2B, HIGH);
}

void girarIzquierda() {
  digitalWrite(Motor1A, HIGH);
  digitalWrite(Motor1B, LOW);
  digitalWrite(Motor2A, LOW);
  digitalWrite(Motor2B, HIGH);
}

void girarDerecha() {
  digitalWrite(Motor1A, LOW);
  digitalWrite(Motor1B, HIGH);
  digitalWrite(Motor2A, HIGH);
  digitalWrite(Motor2B, LOW);
}

void detenerGiro() {
  // En este caso puedes mantener ambos apagados o solo el motor de giro
  digitalWrite(Motor2A,LOW);
  digitalWrite(Motor2B,LOW);
}bluethoot
